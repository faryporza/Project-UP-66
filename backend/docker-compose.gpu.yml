# GPU Docker Compose (requires NVIDIA Container Toolkit)
services:
  backend:
    build:
      context: .
      dockerfile: Dockerfile.gpu
    ports:
      - "8000:8000"
    environment:
      - MODEL_PATH=models/best.pt
      - VIDEO_SOURCE=0
      - DEVICE=0
      - CONFIDENCE=0.05
      - IOU=0.70
      - SHOW_CONF=0.25
      - MAX_DET=300
      - DIRECTION=both
    volumes:
      - ./models:/app/models:ro
      # Uncomment to use video file
      # - ./videos:/app/videos:ro
    devices:
      # Webcam access (Linux)
      - /dev/video0:/dev/video0
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: 1
              capabilities: [gpu]
    restart: unless-stopped
